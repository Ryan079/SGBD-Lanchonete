<div class="page-header">
  <h2>Pedidos</h2>
  <button class="btn btn--primary" (click)="novoPedido()">+ Novo Pedido</button>
</div>

<div class="card">
  <div class="search-bar">
    <select [(ngModel)]="situacao" (change)="filtrar()">
      <option value="">Todas as situa√ß√µes</option>
      <option value="Pendente">Pendente</option>
      <option value="Em Preparo">Em Preparo</option>
      <option value="Entregue">Entregue</option>
      <option value="Cancelado">Cancelado</option>
    </select>
  </div>

  <div class="table-wrapper">
    @if (loading()) {
      <p style="text-align:center;padding:2rem;color:#6b7280">Carregando...</p>
    } @else if (pedidos().length === 0) {
      <div class="empty-state">
        <div class="empty-state__icon">üìã</div>
        <p>Nenhum pedido encontrado</p>
      </div>
    } @else {
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Data/Hora</th>
            <th>Cliente (CPF)</th>
            <th>Valor Total</th>
            <th>Situa√ß√£o</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          @for (p of pedidos(); track p.idPedido) {
            <tr>
              <td>#{{ p.idPedido }}</td>
              <td>{{ p.dataHora | slice:0:16 }}</td>
              <td>{{ p.cpfCliente }}</td>
              <td>{{ p.valorTotal | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</td>
              <td><span class="badge {{ badgeSituacao(p.situacao) }}">{{ p.situacao }}</span></td>
              <td>
                <div class="actions">
                  <button class="btn btn--warning btn--sm" (click)="editar(p)">Editar</button>
                  <button class="btn btn--danger btn--sm" (click)="excluir(p)">Excluir</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <div class="pagination">
        <button class="btn btn--secondary btn--sm" [disabled]="page === 0" (click)="anterior()">‚Üê Anterior</button>
        <span>P√°gina {{ page + 1 }} de {{ totalPages }}</span>
        <button class="btn btn--secondary btn--sm" [disabled]="page >= totalPages - 1" (click)="proximo()">Pr√≥xima ‚Üí</button>
      </div>
    }
  </div>
</div>

@if (showForm()) {
  <app-pedido-form (fechar)="fecharForm()" />
}

@if (showEdit() && pedidoEmEdicao()) {
  <app-pedido-edit [pedido]="pedidoEmEdicao()!" (fechar)="fecharEdit()" />
}
